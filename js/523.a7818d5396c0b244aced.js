"use strict";(self.webpackChunkbabylonjs_typescript_webpack_template=self.webpackChunkbabylonjs_typescript_webpack_template||[]).push([[523],{7523:(e,t,r)=>{r.d(t,{DDSTools:()=>m});var a=r(9111),o=r(461),n=r(9783),s=r(4197),l=r(7565),i=r(9042),f=r(8076),c=r(7782),u=r(4306);c.$.prototype._partialLoadFile=function(e,t,r,a,o=null){this._loadFile(e,(e=>{r[t]=e,r._internalCount++,6===r._internalCount&&a(r)}),void 0,void 0,!0,((e,t)=>{o&&e&&o(e.status+" "+e.statusText,t)}))},c.$.prototype._cascadeLoadFiles=function(e,t,r,a=null){const o=[];o._internalCount=0;for(let e=0;e<6;e++)this._partialLoadFile(r[e],e,o,t,a)},c.$.prototype._cascadeLoadImgs=function(e,t,r,a,o=null,n){const s=[];s._internalCount=0;for(let l=0;l<6;l++)this._partialLoadImg(a[l],l,s,e,t,r,o,n)},c.$.prototype._partialLoadImg=function(e,t,r,a,o,n,s=null,l){const c=(0,f.z)();(0,i.W$)(e,(e=>{r[t]=e,r._internalCount++,a&&a.removePendingData(c),6===r._internalCount&&n&&n(o,r)}),((e,t)=>{a&&a.removePendingData(c),s&&s(e,t)}),a?a.offlineProvider:null,l),a&&a.addPendingData(c)},c.$.prototype.createCubeTextureBase=function(e,t,r,a,n=null,s=null,i,f=null,c=!1,d=0,A=0,p=null,h=null,y=null,_=!1,w=null){const m=p||new l.h(this,7);m.isCube=!0,m.url=e,m.generateMipMaps=!a,m._lodGenerationScale=d,m._lodGenerationOffset=A,m._useSRGBBuffer=!!_&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!a),m!==p&&(m.label=e.substring(0,60)),this._doNotHandleContextLost||(m._extension=f,m._files=r,m._buffer=w);const b=e;this._transformTextureUrl&&!p&&(e=this._transformTextureUrl(e));const F=f??function(e){const t=e.split("?")[0],r=t.lastIndexOf(".");return r>-1?t.substring(r).toLowerCase():""}(e),C=(0,u.gT)(F),B=(l,u)=>{e===b?s&&l&&s(l.status+" "+l.statusText,u):(o.V.Warn(`Failed to load ${e}, falling back to the ${b}`),this.createCubeTextureBase(b,t,r,!!a,n,s,i,f,c,d,A,m,h,y,_,w))};if(C)C.then((a=>{const l=e=>{h&&h(m,e),a.loadCubeData(e,m,c,n,s)};w?l(w):r&&6===r.length?a.supportCascades?this._cascadeLoadFiles(t,(e=>l(e.map((e=>new Uint8Array(e))))),r,s):s?s("Textures type does not support cascades."):o.V.Warn("Texture loader does not support cascades."):this._loadFile(e,(e=>l(new Uint8Array(e))),void 0,void 0,!0,B)}));else{if(!r||0===r.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(t,m,((e,t)=>{y&&y(e,t)}),r,s)}return this._internalTexturesCache.push(m),m};const d=131072,A=131072;function p(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const h=p("DXT1"),y=p("DXT3"),_=p("DXT5"),w=p("DX10");class m{static GetDDSInfo(e){const t=new Int32Array(e.buffer,e.byteOffset,31),r=new Int32Array(e.buffer,e.byteOffset,35);let a=1;t[2]&d&&(a=Math.max(1,t[7]));const o=t[21],n=o===w?r[32]:0;let s=0;switch(o){case 113:s=2;break;case 116:s=1;break;case w:if(10===n){s=2;break}if(2===n){s=1;break}}return{width:t[4],height:t[3],mipmapCount:a,isFourCC:!(4&~t[20]),isRGB:!(64&~t[20]),isLuminance:(t[20]&A)===A,isCube:!(512&~t[28]),isCompressed:o===h||o===y||o===_,dxgiFormat:n,textureType:s}}static _GetHalfFloatAsFloatRGBAArrayBuffer(e,t,r,a,o,n){const l=new Float32Array(a),i=new Uint16Array(o,r);let f=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){const a=4*(t+r*e);l[f]=(0,s.SX)(i[a]),l[f+1]=(0,s.SX)(i[a+1]),l[f+2]=(0,s.SX)(i[a+2]),m.StoreLODInAlphaChannel?l[f+3]=n:l[f+3]=(0,s.SX)(i[a+3]),f+=4}return l}static _GetHalfFloatRGBAArrayBuffer(e,t,r,a,o,n){if(m.StoreLODInAlphaChannel){const l=new Uint16Array(a),i=new Uint16Array(o,r);let f=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){const a=4*(t+r*e);l[f]=i[a],l[f+1]=i[a+1],l[f+2]=i[a+2],l[f+3]=(0,s.LZ)(n),f+=4}return l}return new Uint16Array(o,r,a)}static _GetFloatRGBAArrayBuffer(e,t,r,a,o,n){if(m.StoreLODInAlphaChannel){const s=new Float32Array(a),l=new Float32Array(o,r);let i=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){const a=4*(t+r*e);s[i]=l[a],s[i+1]=l[a+1],s[i+2]=l[a+2],s[i+3]=n,i+=4}return s}return new Float32Array(o,r,a)}static _GetFloatAsHalfFloatRGBAArrayBuffer(e,t,r,a,o,n){const l=new Uint16Array(a),i=new Float32Array(o,r);let f=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++)l[f]=(0,s.LZ)(i[f]),l[f+1]=(0,s.LZ)(i[f+1]),l[f+2]=(0,s.LZ)(i[f+2]),m.StoreLODInAlphaChannel?l[f+3]=(0,s.LZ)(n):l[f+3]=(0,s.LZ)(i[f+3]),f+=4;return l}static _GetFloatAsUIntRGBAArrayBuffer(e,t,r,o,n,s){const l=new Uint8Array(o),i=new Float32Array(n,r);let f=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){const o=4*(t+r*e);l[f]=255*(0,a.OQ)(i[o]),l[f+1]=255*(0,a.OQ)(i[o+1]),l[f+2]=255*(0,a.OQ)(i[o+2]),m.StoreLODInAlphaChannel?l[f+3]=s:l[f+3]=255*(0,a.OQ)(i[o+3]),f+=4}return l}static _GetHalfFloatAsUIntRGBAArrayBuffer(e,t,r,o,n,l){const i=new Uint8Array(o),f=new Uint16Array(n,r);let c=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){const o=4*(t+r*e);i[c]=255*(0,a.OQ)((0,s.SX)(f[o])),i[c+1]=255*(0,a.OQ)((0,s.SX)(f[o+1])),i[c+2]=255*(0,a.OQ)((0,s.SX)(f[o+2])),m.StoreLODInAlphaChannel?i[c+3]=l:i[c+3]=255*(0,a.OQ)((0,s.SX)(f[o+3])),c+=4}return i}static _GetRGBAArrayBuffer(e,t,r,a,o,n,s,l,i){const f=new Uint8Array(a),c=new Uint8Array(o,r);let u=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){const a=4*(t+r*e);f[u]=c[a+n],f[u+1]=c[a+s],f[u+2]=c[a+l],f[u+3]=c[a+i],u+=4}return f}static _ExtractLongWordOrder(e){return 0===e||255===e||-16777216===e?0:1+m._ExtractLongWordOrder(e>>8)}static _GetRGBArrayBuffer(e,t,r,a,o,n,s,l){const i=new Uint8Array(a),f=new Uint8Array(o,r);let c=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){const a=3*(t+r*e);i[c]=f[a+n],i[c+1]=f[a+s],i[c+2]=f[a+l],c+=3}return i}static _GetLuminanceArrayBuffer(e,t,r,a,o){const n=new Uint8Array(a),s=new Uint8Array(o,r);let l=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){const a=t+r*e;n[l]=s[a],l++}return n}static UploadDDSLevels(e,t,r,a,s,l,i=-1,f,c=!0){let u=null;a.sphericalPolynomial&&(u=[]);const A=!!e.getCaps().s3tc;t.generateMipMaps=s;const p=new Int32Array(r.buffer,r.byteOffset,31);let b,F,C,B,G,x,O,g=0,L=0,P=1;if(542327876!==p[0])return void o.V.Error("Invalid magic number in DDS header");if(!a.isFourCC&&!a.isRGB&&!a.isLuminance)return void o.V.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(a.isCompressed&&!A)return void o.V.Error("Compressed textures are not supported on this platform.");let R=p[22];B=p[1]+4;let v=!1;if(a.isFourCC)switch(b=p[21],b){case h:P=8,L=33777;break;case y:P=16,L=33778;break;case _:P=16,L=33779;break;case 113:v=!0,R=64;break;case 116:v=!0,R=128;break;case w:{B+=20;let e=!1;switch(a.dxgiFormat){case 10:v=!0,R=64,e=!0;break;case 2:v=!0,R=128,e=!0;break;case 88:a.isRGB=!0,a.isFourCC=!1,R=32,e=!0}if(e)break}default:return void o.V.Error(["Unsupported FourCC code:",(S=b,String.fromCharCode(255&S,S>>8&255,S>>16&255,S>>24&255))])}var S;const D=m._ExtractLongWordOrder(p[23]),T=m._ExtractLongWordOrder(p[24]),U=m._ExtractLongWordOrder(p[25]),k=m._ExtractLongWordOrder(p[26]);v&&(L=e._getRGBABufferInternalSizedFormat(a.textureType)),x=1,p[2]&d&&!1!==s&&(x=Math.max(1,p[7]));const I=f||0,E=e.getCaps();for(let o=I;o<l;o++){for(F=p[4],C=p[3],O=0;O<x;++O){if(-1===i||i===O){const n=-1===i?O:0;if(!a.isCompressed&&a.isFourCC){t.format=5,g=F*C*4;let a=null;if(e._badOS||e._badDesktopOS||!E.textureHalfFloat&&!E.textureFloat)128===R?(a=m._GetFloatAsUIntRGBAArrayBuffer(F,C,r.byteOffset+B,g,r.buffer,n),u&&0==n&&u.push(m._GetFloatRGBAArrayBuffer(F,C,r.byteOffset+B,g,r.buffer,n))):64===R&&(a=m._GetHalfFloatAsUIntRGBAArrayBuffer(F,C,r.byteOffset+B,g,r.buffer,n),u&&0==n&&u.push(m._GetHalfFloatAsFloatRGBAArrayBuffer(F,C,r.byteOffset+B,g,r.buffer,n))),t.type=0;else{const e=E.textureFloat&&(c&&E.textureFloatLinearFiltering||!c),o=E.textureHalfFloat&&(c&&E.textureHalfFloatLinearFiltering||!c),s=(128===R||64===R&&!o)&&e?1:(64===R||128===R&&!e)&&o?2:0;let l,i=null;if(128===R)switch(s){case 1:l=m._GetFloatRGBAArrayBuffer,i=null;break;case 2:l=m._GetFloatAsHalfFloatRGBAArrayBuffer,i=m._GetFloatRGBAArrayBuffer;break;case 0:l=m._GetFloatAsUIntRGBAArrayBuffer,i=m._GetFloatRGBAArrayBuffer}else switch(s){case 1:l=m._GetHalfFloatAsFloatRGBAArrayBuffer,i=null;break;case 2:l=m._GetHalfFloatRGBAArrayBuffer,i=m._GetHalfFloatAsFloatRGBAArrayBuffer;break;case 0:l=m._GetHalfFloatAsUIntRGBAArrayBuffer,i=m._GetHalfFloatAsFloatRGBAArrayBuffer}t.type=s,a=l(F,C,r.byteOffset+B,g,r.buffer,n),u&&0==n&&u.push(i?i(F,C,r.byteOffset+B,g,r.buffer,n):a)}a&&e._uploadDataToTextureDirectly(t,a,o,n)}else if(a.isRGB)t.type=0,24===R?(t.format=4,g=F*C*3,G=m._GetRGBArrayBuffer(F,C,r.byteOffset+B,g,r.buffer,D,T,U),e._uploadDataToTextureDirectly(t,G,o,n)):(t.format=5,g=F*C*4,G=m._GetRGBAArrayBuffer(F,C,r.byteOffset+B,g,r.buffer,D,T,U,k),e._uploadDataToTextureDirectly(t,G,o,n));else if(a.isLuminance){const a=e._getUnpackAlignement(),s=F;g=Math.floor((F+a-1)/a)*a*(C-1)+s,G=m._GetLuminanceArrayBuffer(F,C,r.byteOffset+B,g,r.buffer),t.format=1,t.type=0,e._uploadDataToTextureDirectly(t,G,o,n)}else g=Math.max(4,F)/4*Math.max(4,C)/4*P,G=new Uint8Array(r.buffer,r.byteOffset+B,g),t.type=0,e._uploadCompressedDataToTextureDirectly(t,L,F,C,G,o,n)}B+=R?F*C*(R/8):g,F*=.5,C*=.5,F=Math.max(1,F),C=Math.max(1,C)}if(void 0!==f)break}u&&u.length>0?a.sphericalPolynomial=n.d.ConvertCubeMapToSphericalPolynomial({size:p[4],right:u[0],left:u[1],up:u[2],down:u[3],front:u[4],back:u[5],format:5,type:1,gammaSpace:!1}):a.sphericalPolynomial=void 0}}m.StoreLODInAlphaChannel=!1},9783:(e,t,r)=>{r.d(t,{d:()=>f});var a=r(4983),o=r(9111),n=r(7369),s=r(507),l=r(9341);class i{constructor(e,t,r,a){this.name=e,this.worldAxisForNormal=t,this.worldAxisForFileX=r,this.worldAxisForFileY=a}}class f{static ConvertCubeMapTextureToSphericalPolynomial(e){if(!e.isCube)return null;e.getScene()?.getEngine().flushFramebuffer();const t=e.getSize().width,r=e.readPixels(0,void 0,void 0,!1),a=e.readPixels(1,void 0,void 0,!1);let o,n;e.isRenderTarget?(o=e.readPixels(3,void 0,void 0,!1),n=e.readPixels(2,void 0,void 0,!1)):(o=e.readPixels(2,void 0,void 0,!1),n=e.readPixels(3,void 0,void 0,!1));const s=e.readPixels(4,void 0,void 0,!1),l=e.readPixels(5,void 0,void 0,!1),i=e.gammaSpace;let f=0;return 1!=e.textureType&&2!=e.textureType||(f=1),new Promise((e=>{Promise.all([a,r,o,n,s,l]).then((([r,a,o,n,s,l])=>{const c={size:t,right:a,left:r,up:o,down:n,front:s,back:l,format:5,type:f,gammaSpace:i};e(this.ConvertCubeMapToSphericalPolynomial(c))}))}))}static _AreaElement(e,t){return Math.atan2(e*t,Math.sqrt(e*e+t*t+1))}static ConvertCubeMapToSphericalPolynomial(e){const t=new n.O;let r=0;const a=2/e.size,i=a,f=.5*a,c=f-1;for(let n=0;n<6;n++){const u=this._FileFaces[n],d=e[u.name];let A=c;const p=5===e.format?4:3;for(let n=0;n<e.size;n++){let h=c;for(let i=0;i<e.size;i++){const c=u.worldAxisForFileX.scale(h).add(u.worldAxisForFileY.scale(A)).add(u.worldAxisForNormal);c.normalize();const y=this._AreaElement(h-f,A-f)-this._AreaElement(h-f,A+f)-this._AreaElement(h+f,A-f)+this._AreaElement(h+f,A+f);let _=d[n*e.size*p+i*p+0],w=d[n*e.size*p+i*p+1],m=d[n*e.size*p+i*p+2];isNaN(_)&&(_=0),isNaN(w)&&(w=0),isNaN(m)&&(m=0),0===e.type&&(_/=255,w/=255,m/=255),e.gammaSpace&&(_=Math.pow((0,o.OQ)(_),s.tk),w=Math.pow((0,o.OQ)(w),s.tk),m=Math.pow((0,o.OQ)(m),s.tk));const b=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const e=Math.max(_,w,m);if(e>b){const t=b/e;_*=t,w*=t,m*=t}}else _=(0,o.OQ)(_,0,b),w=(0,o.OQ)(w,0,b),m=(0,o.OQ)(m,0,b);const F=new l.v9(_,w,m);t.addLight(c,F,y),r+=y,h+=a}A+=i}}const u=4*Math.PI*6/6/r;return t.scaleInPlace(u),t.convertIncidentRadianceToIrradiance(),t.convertIrradianceToLambertianRadiance(),n.Q.FromHarmonics(t)}}f._FileFaces=[new i("right",new a.Pq(1,0,0),new a.Pq(0,0,-1),new a.Pq(0,-1,0)),new i("left",new a.Pq(-1,0,0),new a.Pq(0,0,1),new a.Pq(0,-1,0)),new i("up",new a.Pq(0,1,0),new a.Pq(1,0,0),new a.Pq(0,0,1)),new i("down",new a.Pq(0,-1,0),new a.Pq(1,0,0),new a.Pq(0,0,-1)),new i("front",new a.Pq(0,0,1),new a.Pq(1,0,0),new a.Pq(0,-1,0)),new i("back",new a.Pq(0,0,-1),new a.Pq(-1,0,0),new a.Pq(0,-1,0))],f.MAX_HDRI_VALUE=4096,f.PRESERVE_CLAMPED_COLORS=!1}}]);
//# sourceMappingURL=523.a7818d5396c0b244aced.js.map