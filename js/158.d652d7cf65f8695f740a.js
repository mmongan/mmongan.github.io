"use strict";(self.webpackChunkbabylonjs_typescript_webpack_template=self.webpackChunkbabylonjs_typescript_webpack_template||[]).push([[158,523],{2158:(e,t,r)=>{r.r(t),r.d(t,{_DDSTextureLoader:()=>n});var a=r(7369),o=r(7523);class n{constructor(){this.supportCascades=!0}loadCubeData(e,t,r,n){const s=t.getEngine();let i,l=!1,f=1e3;if(Array.isArray(e))for(let r=0;r<e.length;r++){const a=e[r];i=o.DDSTools.GetDDSInfo(a),t.width=i.width,t.height=i.height,l=(i.isRGB||i.isLuminance||i.mipmapCount>1)&&t.generateMipMaps,s._unpackFlipY(i.isCompressed),o.DDSTools.UploadDDSLevels(s,t,a,i,l,6,-1,r),i.isFourCC||1!==i.mipmapCount?f=i.mipmapCount-1:s.generateMipMapsForCubemap(t)}else{const n=e;i=o.DDSTools.GetDDSInfo(n),t.width=i.width,t.height=i.height,r&&(i.sphericalPolynomial=new a.Q),l=(i.isRGB||i.isLuminance||i.mipmapCount>1)&&t.generateMipMaps,s._unpackFlipY(i.isCompressed),o.DDSTools.UploadDDSLevels(s,t,n,i,l,6),i.isFourCC||1!==i.mipmapCount?f=i.mipmapCount-1:s.generateMipMapsForCubemap(t,!1)}s._setCubeMapTextureParams(t,l,f),t.isReady=!0,t.onLoadedObservable.notifyObservers(t),t.onLoadedObservable.clear(),n&&n({isDDS:!0,width:t.width,info:i,data:e,texture:t})}loadData(e,t,r){const a=o.DDSTools.GetDDSInfo(e),n=(a.isRGB||a.isLuminance||a.mipmapCount>1)&&t.generateMipMaps&&Math.max(a.width,a.height)>>a.mipmapCount-1==1;r(a.width,a.height,n,a.isFourCC,(()=>{o.DDSTools.UploadDDSLevels(t.getEngine(),t,e,a,n,1)}))}}},7523:(e,t,r)=>{r.d(t,{DDSTools:()=>w});var a=r(9111),o=r(461),n=r(9783),s=r(4197),i=r(7565),l=r(9042),f=r(8076),u=r(7782),c=r(4306);u.$.prototype._partialLoadFile=function(e,t,r,a,o=null){this._loadFile(e,(e=>{r[t]=e,r._internalCount++,6===r._internalCount&&a(r)}),void 0,void 0,!0,((e,t)=>{o&&e&&o(e.status+" "+e.statusText,t)}))},u.$.prototype._cascadeLoadFiles=function(e,t,r,a=null){const o=[];o._internalCount=0;for(let e=0;e<6;e++)this._partialLoadFile(r[e],e,o,t,a)},u.$.prototype._cascadeLoadImgs=function(e,t,r,a,o=null,n){const s=[];s._internalCount=0;for(let i=0;i<6;i++)this._partialLoadImg(a[i],i,s,e,t,r,o,n)},u.$.prototype._partialLoadImg=function(e,t,r,a,o,n,s=null,i){const u=(0,f.z)();(0,l.W$)(e,(e=>{r[t]=e,r._internalCount++,a&&a.removePendingData(u),6===r._internalCount&&n&&n(o,r)}),((e,t)=>{a&&a.removePendingData(u),s&&s(e,t)}),a?a.offlineProvider:null,i),a&&a.addPendingData(u)},u.$.prototype.createCubeTextureBase=function(e,t,r,a,n=null,s=null,l,f=null,u=!1,d=0,p=0,h=null,A=null,m=null,y=!1,_=null){const w=h||new i.h(this,7);w.isCube=!0,w.url=e,w.generateMipMaps=!a,w._lodGenerationScale=d,w._lodGenerationOffset=p,w._useSRGBBuffer=!!y&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!a),w!==h&&(w.label=e.substring(0,60)),this._doNotHandleContextLost||(w._extension=f,w._files=r,w._buffer=_);const C=e;this._transformTextureUrl&&!h&&(e=this._transformTextureUrl(e));const b=f??function(e){const t=e.split("?")[0],r=t.lastIndexOf(".");return r>-1?t.substring(r).toLowerCase():""}(e),F=(0,c.gT)(b),D=(i,c)=>{e===C?s&&i&&s(i.status+" "+i.statusText,c):(o.V.Warn(`Failed to load ${e}, falling back to the ${C}`),this.createCubeTextureBase(C,t,r,!!a,n,s,l,f,u,d,p,w,A,m,y,_))};if(F)F.then((a=>{const i=e=>{A&&A(w,e),a.loadCubeData(e,w,u,n,s)};_?i(_):r&&6===r.length?a.supportCascades?this._cascadeLoadFiles(t,(e=>i(e.map((e=>new Uint8Array(e))))),r,s):s?s("Textures type does not support cascades."):o.V.Warn("Texture loader does not support cascades."):this._loadFile(e,(e=>i(new Uint8Array(e))),void 0,void 0,!0,D)}));else{if(!r||0===r.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(t,w,((e,t)=>{m&&m(e,t)}),r,s)}return this._internalTexturesCache.push(w),w};const d=131072,p=131072;function h(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const A=h("DXT1"),m=h("DXT3"),y=h("DXT5"),_=h("DX10");class w{static GetDDSInfo(e){const t=new Int32Array(e.buffer,e.byteOffset,31),r=new Int32Array(e.buffer,e.byteOffset,35);let a=1;t[2]&d&&(a=Math.max(1,t[7]));const o=t[21],n=o===_?r[32]:0;let s=0;switch(o){case 113:s=2;break;case 116:s=1;break;case _:if(10===n){s=2;break}if(2===n){s=1;break}}return{width:t[4],height:t[3],mipmapCount:a,isFourCC:!(4&~t[20]),isRGB:!(64&~t[20]),isLuminance:(t[20]&p)===p,isCube:!(512&~t[28]),isCompressed:o===A||o===m||o===y,dxgiFormat:n,textureType:s}}static _GetHalfFloatAsFloatRGBAArrayBuffer(e,t,r,a,o,n){const i=new Float32Array(a),l=new Uint16Array(o,r);let f=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){const a=4*(t+r*e);i[f]=(0,s.SX)(l[a]),i[f+1]=(0,s.SX)(l[a+1]),i[f+2]=(0,s.SX)(l[a+2]),w.StoreLODInAlphaChannel?i[f+3]=n:i[f+3]=(0,s.SX)(l[a+3]),f+=4}return i}static _GetHalfFloatRGBAArrayBuffer(e,t,r,a,o,n){if(w.StoreLODInAlphaChannel){const i=new Uint16Array(a),l=new Uint16Array(o,r);let f=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){const a=4*(t+r*e);i[f]=l[a],i[f+1]=l[a+1],i[f+2]=l[a+2],i[f+3]=(0,s.LZ)(n),f+=4}return i}return new Uint16Array(o,r,a)}static _GetFloatRGBAArrayBuffer(e,t,r,a,o,n){if(w.StoreLODInAlphaChannel){const s=new Float32Array(a),i=new Float32Array(o,r);let l=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){const a=4*(t+r*e);s[l]=i[a],s[l+1]=i[a+1],s[l+2]=i[a+2],s[l+3]=n,l+=4}return s}return new Float32Array(o,r,a)}static _GetFloatAsHalfFloatRGBAArrayBuffer(e,t,r,a,o,n){const i=new Uint16Array(a),l=new Float32Array(o,r);let f=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++)i[f]=(0,s.LZ)(l[f]),i[f+1]=(0,s.LZ)(l[f+1]),i[f+2]=(0,s.LZ)(l[f+2]),w.StoreLODInAlphaChannel?i[f+3]=(0,s.LZ)(n):i[f+3]=(0,s.LZ)(l[f+3]),f+=4;return i}static _GetFloatAsUIntRGBAArrayBuffer(e,t,r,o,n,s){const i=new Uint8Array(o),l=new Float32Array(n,r);let f=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){const o=4*(t+r*e);i[f]=255*(0,a.OQ)(l[o]),i[f+1]=255*(0,a.OQ)(l[o+1]),i[f+2]=255*(0,a.OQ)(l[o+2]),w.StoreLODInAlphaChannel?i[f+3]=s:i[f+3]=255*(0,a.OQ)(l[o+3]),f+=4}return i}static _GetHalfFloatAsUIntRGBAArrayBuffer(e,t,r,o,n,i){const l=new Uint8Array(o),f=new Uint16Array(n,r);let u=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){const o=4*(t+r*e);l[u]=255*(0,a.OQ)((0,s.SX)(f[o])),l[u+1]=255*(0,a.OQ)((0,s.SX)(f[o+1])),l[u+2]=255*(0,a.OQ)((0,s.SX)(f[o+2])),w.StoreLODInAlphaChannel?l[u+3]=i:l[u+3]=255*(0,a.OQ)((0,s.SX)(f[o+3])),u+=4}return l}static _GetRGBAArrayBuffer(e,t,r,a,o,n,s,i,l){const f=new Uint8Array(a),u=new Uint8Array(o,r);let c=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){const a=4*(t+r*e);f[c]=u[a+n],f[c+1]=u[a+s],f[c+2]=u[a+i],f[c+3]=u[a+l],c+=4}return f}static _ExtractLongWordOrder(e){return 0===e||255===e||-16777216===e?0:1+w._ExtractLongWordOrder(e>>8)}static _GetRGBArrayBuffer(e,t,r,a,o,n,s,i){const l=new Uint8Array(a),f=new Uint8Array(o,r);let u=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){const a=3*(t+r*e);l[u]=f[a+n],l[u+1]=f[a+s],l[u+2]=f[a+i],u+=3}return l}static _GetLuminanceArrayBuffer(e,t,r,a,o){const n=new Uint8Array(a),s=new Uint8Array(o,r);let i=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){const a=t+r*e;n[i]=s[a],i++}return n}static UploadDDSLevels(e,t,r,a,s,i,l=-1,f,u=!0){let c=null;a.sphericalPolynomial&&(c=[]);const p=!!e.getCaps().s3tc;t.generateMipMaps=s;const h=new Int32Array(r.buffer,r.byteOffset,31);let C,b,F,D,G,B,g,x=0,L=0,S=1;if(542327876!==h[0])return void o.V.Error("Invalid magic number in DDS header");if(!a.isFourCC&&!a.isRGB&&!a.isLuminance)return void o.V.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(a.isCompressed&&!p)return void o.V.Error("Compressed textures are not supported on this platform.");let O=h[22];D=h[1]+4;let v=!1;if(a.isFourCC)switch(C=h[21],C){case A:S=8,L=33777;break;case m:S=16,L=33778;break;case y:S=16,L=33779;break;case 113:v=!0,O=64;break;case 116:v=!0,O=128;break;case _:{D+=20;let e=!1;switch(a.dxgiFormat){case 10:v=!0,O=64,e=!0;break;case 2:v=!0,O=128,e=!0;break;case 88:a.isRGB=!0,a.isFourCC=!1,O=32,e=!0}if(e)break}default:return void o.V.Error(["Unsupported FourCC code:",(P=C,String.fromCharCode(255&P,P>>8&255,P>>16&255,P>>24&255))])}var P;const R=w._ExtractLongWordOrder(h[23]),T=w._ExtractLongWordOrder(h[24]),M=w._ExtractLongWordOrder(h[25]),U=w._ExtractLongWordOrder(h[26]);v&&(L=e._getRGBABufferInternalSizedFormat(a.textureType)),B=1,h[2]&d&&!1!==s&&(B=Math.max(1,h[7]));const I=f||0,k=e.getCaps();for(let o=I;o<i;o++){for(b=h[4],F=h[3],g=0;g<B;++g){if(-1===l||l===g){const n=-1===l?g:0;if(!a.isCompressed&&a.isFourCC){t.format=5,x=b*F*4;let a=null;if(e._badOS||e._badDesktopOS||!k.textureHalfFloat&&!k.textureFloat)128===O?(a=w._GetFloatAsUIntRGBAArrayBuffer(b,F,r.byteOffset+D,x,r.buffer,n),c&&0==n&&c.push(w._GetFloatRGBAArrayBuffer(b,F,r.byteOffset+D,x,r.buffer,n))):64===O&&(a=w._GetHalfFloatAsUIntRGBAArrayBuffer(b,F,r.byteOffset+D,x,r.buffer,n),c&&0==n&&c.push(w._GetHalfFloatAsFloatRGBAArrayBuffer(b,F,r.byteOffset+D,x,r.buffer,n))),t.type=0;else{const e=k.textureFloat&&(u&&k.textureFloatLinearFiltering||!u),o=k.textureHalfFloat&&(u&&k.textureHalfFloatLinearFiltering||!u),s=(128===O||64===O&&!o)&&e?1:(64===O||128===O&&!e)&&o?2:0;let i,l=null;if(128===O)switch(s){case 1:i=w._GetFloatRGBAArrayBuffer,l=null;break;case 2:i=w._GetFloatAsHalfFloatRGBAArrayBuffer,l=w._GetFloatRGBAArrayBuffer;break;case 0:i=w._GetFloatAsUIntRGBAArrayBuffer,l=w._GetFloatRGBAArrayBuffer}else switch(s){case 1:i=w._GetHalfFloatAsFloatRGBAArrayBuffer,l=null;break;case 2:i=w._GetHalfFloatRGBAArrayBuffer,l=w._GetHalfFloatAsFloatRGBAArrayBuffer;break;case 0:i=w._GetHalfFloatAsUIntRGBAArrayBuffer,l=w._GetHalfFloatAsFloatRGBAArrayBuffer}t.type=s,a=i(b,F,r.byteOffset+D,x,r.buffer,n),c&&0==n&&c.push(l?l(b,F,r.byteOffset+D,x,r.buffer,n):a)}a&&e._uploadDataToTextureDirectly(t,a,o,n)}else if(a.isRGB)t.type=0,24===O?(t.format=4,x=b*F*3,G=w._GetRGBArrayBuffer(b,F,r.byteOffset+D,x,r.buffer,R,T,M),e._uploadDataToTextureDirectly(t,G,o,n)):(t.format=5,x=b*F*4,G=w._GetRGBAArrayBuffer(b,F,r.byteOffset+D,x,r.buffer,R,T,M,U),e._uploadDataToTextureDirectly(t,G,o,n));else if(a.isLuminance){const a=e._getUnpackAlignement(),s=b;x=Math.floor((b+a-1)/a)*a*(F-1)+s,G=w._GetLuminanceArrayBuffer(b,F,r.byteOffset+D,x,r.buffer),t.format=1,t.type=0,e._uploadDataToTextureDirectly(t,G,o,n)}else x=Math.max(4,b)/4*Math.max(4,F)/4*S,G=new Uint8Array(r.buffer,r.byteOffset+D,x),t.type=0,e._uploadCompressedDataToTextureDirectly(t,L,b,F,G,o,n)}D+=O?b*F*(O/8):x,b*=.5,F*=.5,b=Math.max(1,b),F=Math.max(1,F)}if(void 0!==f)break}c&&c.length>0?a.sphericalPolynomial=n.d.ConvertCubeMapToSphericalPolynomial({size:h[4],right:c[0],left:c[1],up:c[2],down:c[3],front:c[4],back:c[5],format:5,type:1,gammaSpace:!1}):a.sphericalPolynomial=void 0}}w.StoreLODInAlphaChannel=!1},9783:(e,t,r)=>{r.d(t,{d:()=>f});var a=r(4983),o=r(9111),n=r(7369),s=r(507),i=r(9341);class l{constructor(e,t,r,a){this.name=e,this.worldAxisForNormal=t,this.worldAxisForFileX=r,this.worldAxisForFileY=a}}class f{static ConvertCubeMapTextureToSphericalPolynomial(e){if(!e.isCube)return null;e.getScene()?.getEngine().flushFramebuffer();const t=e.getSize().width,r=e.readPixels(0,void 0,void 0,!1),a=e.readPixels(1,void 0,void 0,!1);let o,n;e.isRenderTarget?(o=e.readPixels(3,void 0,void 0,!1),n=e.readPixels(2,void 0,void 0,!1)):(o=e.readPixels(2,void 0,void 0,!1),n=e.readPixels(3,void 0,void 0,!1));const s=e.readPixels(4,void 0,void 0,!1),i=e.readPixels(5,void 0,void 0,!1),l=e.gammaSpace;let f=0;return 1!=e.textureType&&2!=e.textureType||(f=1),new Promise((e=>{Promise.all([a,r,o,n,s,i]).then((([r,a,o,n,s,i])=>{const u={size:t,right:a,left:r,up:o,down:n,front:s,back:i,format:5,type:f,gammaSpace:l};e(this.ConvertCubeMapToSphericalPolynomial(u))}))}))}static _AreaElement(e,t){return Math.atan2(e*t,Math.sqrt(e*e+t*t+1))}static ConvertCubeMapToSphericalPolynomial(e){const t=new n.O;let r=0;const a=2/e.size,l=a,f=.5*a,u=f-1;for(let n=0;n<6;n++){const c=this._FileFaces[n],d=e[c.name];let p=u;const h=5===e.format?4:3;for(let n=0;n<e.size;n++){let A=u;for(let l=0;l<e.size;l++){const u=c.worldAxisForFileX.scale(A).add(c.worldAxisForFileY.scale(p)).add(c.worldAxisForNormal);u.normalize();const m=this._AreaElement(A-f,p-f)-this._AreaElement(A-f,p+f)-this._AreaElement(A+f,p-f)+this._AreaElement(A+f,p+f);let y=d[n*e.size*h+l*h+0],_=d[n*e.size*h+l*h+1],w=d[n*e.size*h+l*h+2];isNaN(y)&&(y=0),isNaN(_)&&(_=0),isNaN(w)&&(w=0),0===e.type&&(y/=255,_/=255,w/=255),e.gammaSpace&&(y=Math.pow((0,o.OQ)(y),s.tk),_=Math.pow((0,o.OQ)(_),s.tk),w=Math.pow((0,o.OQ)(w),s.tk));const C=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const e=Math.max(y,_,w);if(e>C){const t=C/e;y*=t,_*=t,w*=t}}else y=(0,o.OQ)(y,0,C),_=(0,o.OQ)(_,0,C),w=(0,o.OQ)(w,0,C);const b=new i.v9(y,_,w);t.addLight(u,b,m),r+=m,A+=a}p+=l}}const c=4*Math.PI*6/6/r;return t.scaleInPlace(c),t.convertIncidentRadianceToIrradiance(),t.convertIrradianceToLambertianRadiance(),n.Q.FromHarmonics(t)}}f._FileFaces=[new l("right",new a.Pq(1,0,0),new a.Pq(0,0,-1),new a.Pq(0,-1,0)),new l("left",new a.Pq(-1,0,0),new a.Pq(0,0,1),new a.Pq(0,-1,0)),new l("up",new a.Pq(0,1,0),new a.Pq(1,0,0),new a.Pq(0,0,1)),new l("down",new a.Pq(0,-1,0),new a.Pq(1,0,0),new a.Pq(0,0,-1)),new l("front",new a.Pq(0,0,1),new a.Pq(1,0,0),new a.Pq(0,-1,0)),new l("back",new a.Pq(0,0,-1),new a.Pq(-1,0,0),new a.Pq(0,-1,0))],f.MAX_HDRI_VALUE=4096,f.PRESERVE_CLAMPED_COLORS=!1}}]);
//# sourceMappingURL=158.d652d7cf65f8695f740a.js.map